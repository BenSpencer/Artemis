lang['Applications'] = 'Applications';
lang['Files'] = 'Files';
lang['People'] = 'People';
lang['Home'] = 'Home';
lang['Documents']='Documents';
lang['Images']='Images';
lang['Shared by me']='Shared by me';
lang['Shared by my contacts']='Shared by my contacts';
lang['Create new contact']='Create new contact';
lang['Groups']='Groups';
lang['Other groups in this network']='Other groups in this network';
lang['Are you sure you want to join this workgroup?']='Are you sure you want to join this workgroup?';
lang['Join workgroup']='Join workgroup';
lang['Delete a contact']='Delete a contact';
lang['Are you sure you want to add']='Are you sure you want to add';
lang['as a contact?']='as a contact?';
lang['Are you sure you want to delete']='Are you sure you want to delete';
lang['Are you sure you want to leave this workgroup?']='Are you sure you want to leave this workgroup?';
lang['Join workgroup']='Join workgroup';
lang['Create group']='Create group';


/*
*                 eyeos - The Open Source Cloud's Web Desktop
*                               Version 2.0
*                   Copyright (C) 2007 - 2010 eyeos Team
*
* This program is free software; you can redistribute it and/or modify it under
* the terms of the GNU Affero General Public License version 3 as published by the
* Free Software Foundation.
*
* This program is distributed in the hope that it will be useful, but WITHOUT
* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
* FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more
* details.
*
* You should have received a copy of the GNU Affero General Public License
* version 3 along with this program in the file "LICENSE".  If not, see
* <http://www.gnu.org/licenses/agpl-3.0.txt>.
*
* See www.eyeos.org for more details. All requests should be sent to licensing@eyeos.org
*
* The interactive user interfaces in modified source and object code versions
* of this program must display Appropriate Legal Notices, as required under
* Section 5 of the GNU Affero General Public License version 3.
*
* In accordance with Section 7(b) of the GNU Affero General Public License version 3,
* these Appropriate Legal Notices must retain the display of the "Powered by
* eyeos" logo and retain the original copyright notice. If the display of the
* logo is not reasonably feasible for technical reasons, the Appropriate Legal Notices
* must display the words "Powered by eyeos" and retain the original copyright notice.
*/

function topmenu_application(checknum, pid, args) {
    var application = new eyeos.application.Topmenu(checknum, pid);
    application.initApplication(checknum, args);
}

qx.Class.define('eyeos.application.Topmenu', {
    extend: eyeos.system.EyeApplication,

    construct: function (checknum, pid) {
        arguments.callee.base.call(this, 'topmenu', checknum, pid);
    },

    properties: {

    },

    members: {
        initApplication: function(checknum, args) {
            var bus = eyeos.messageBus.getInstance();
            var user = bus.retrieve('user');
            var screen = bus.retrieve('screen');
            var eyeDesktop = bus.retrieve('eyeDesktop');

            var isAdmin = args[0];
            var apps = args[1];
            var decoratorTopmenu = new qx.ui.decoration.Background().set({
                    backgroundImage: 'eyeos/extern/images/Top_bar.png'
                    //backgroundRepeat: 'scale'
            });
            //	Container TabView
            var containTabs = new qx.ui.container.Composite(new qx.ui.layout.HBox());
            containTabs.setDecorator(decoratorTopmenu);
            containTabs.set ({
                'zIndex' : 500002,
                'height' : 32
            });

            //applications -----------------------

            var applicationsBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());

            //izquierdo: 404040
            //derecho: 262626
            var applicationsLabel = new qx.ui.basic.Label('Applications').set({
                value: '<span style="font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;"><strong>'+tr('Applications')+'</strong></span>',
                rich: true,
                marginTop: 6,
                marginLeft: 10,
                marginRight: 10,
                textColor: '#E5E5E5'
            });

            applicationsLabel.addListener('mouseover', function() {
                applicationsLabel.setTextColor('#57A4DF');
            });

            applicationsLabel.addListener('mouseout', function() {
                applicationsLabel.setTextColor('#E5E5E5');
            });

            applicationsBox.add(applicationsLabel,{'flex' : 1});


            this.appsMenu = new qx.ui.menu.Menu();

            //desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px, 
            var decoratorWidgetMenu = new qx.ui.decoration.RoundBorderBeveled(null, 'white', 0, 0, 0, 5, 5, "0 5px 16px -3px black");
            this.appsMenu.set({
                    'backgroundColor': 'white',
                    'padding': 0,
                    'paddingTop' : 4,
                    'paddingBottom' : 4,
                    'decorator': decoratorWidgetMenu,
                    'marginLeft': 5,
                    'minWidth': 200,
                    'shadow' : false,
                    'blockerColor' : 'red'
            });
			var firstApps = [];
			var order = ['files', 'documents', 'calendar', 'rmail', 'notepad', 'calculator', 'sysmon'];
			order.reverse();
			
			for(var i = 0; i < apps.length; i++) {
				for(var x = 0; x < order.length; x++) {
					if(apps[i].name == order[x]) {
						firstApps[x] = apps[i];
						apps.splice(i, 1);
                        break;
					}
				}
			}

			for(var i in firstApps) {
				apps.unshift(firstApps[i]);
			}

            for(var i in apps) {
                if(apps[i].listable) {
                    var buttonApp = new qx.ui.menu.Button(apps[i].displayName, apps[i].image);
                    buttonApp.getChildControl('icon').set({
                        'scale' : true,
                        'height' : 22,
                        'width' : 22
                    });

					buttonApp.set({
						'paddingTop': 7,
						'paddingBottom': 7
					});

                    buttonApp.setUserData('appName', apps[i].name);
                    buttonApp.addListener('execute', function(e) {
                        var target = e.getTarget();
                        eyeos.execute(target.getUserData('appName'), this.getChecknum());
                    }, this);

					buttonApp.setDraggable(true);

					buttonApp.addListener('dragstart', function(e) {
						var x = e.getDocumentLeft();
						var y = e.getDocumentTop();
						y = y - 20;
						x = x + 11;
						this.clipImage = e.getTarget().getChildControl('icon').clone();
						this.clipImage.set({
							'scale': true,
							'height': 42,
							'width' : 42
						});
						document.eyeDesktop.add(this.clipImage);
						this.clipImage.set({
							zIndex: 100003
						});
						this.clipImage.setMarginTop(y);
						this.clipImage.setMarginLeft(x);
						e.stopPropagation();
					}, this);

					buttonApp.addListener('drag', function(e) {
						var x = e.getDocumentLeft();
						var y = e.getDocumentTop();
						y = y - 20;
						x = x + 11;
						this.clipImage.setMarginTop(y);
						this.clipImage.setMarginLeft(x);
					}, this);

					buttonApp.addListener('dragend', function(e) {
						this.clipImage.destroy();
					}, this);
                    this.appsMenu.add(buttonApp);
                }
            }
            
            this.appsMenu.setOpener(applicationsBox);

            applicationsBox.addListener('click', function(e) {
                e.stopPropagation();
                this.appsMenu.open();
            }, this);
            

            // -------------------------------------

            //separator ----------------------------

            var separator = new qx.ui.basic.Image();
            separator.setSource('eyeos/extern/images/Separator.png');

            // -------------------------------------

            containTabs.add(applicationsBox);
            containTabs.add(separator);

            //files -----------------------

            var filesBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());

            //izquierdo: 404040
            //derecho: 262626
            var filesLabel = new qx.ui.basic.Label('Files').set({
                value: '<span style="font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;"><strong>'+tr('Files')+'</strong></span>',
                rich: true,
                marginTop: 6,
                marginLeft: 10,
                marginRight: 10,
                textColor: '#E5E5E5'
            });

            filesLabel.addListener('mouseover', function() {
                filesLabel.setTextColor('#57A4DF');
            });

            filesLabel.addListener('mouseout', function() {
                filesLabel.setTextColor('#E5E5E5');
            });

            filesBox.add(filesLabel,{'flex' : 1});

            this.filesMenu = new qx.ui.menu.Menu();

            //desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px,
            var decoratorWidgetMenu = new qx.ui.decoration.RoundBorderBeveled(null, 'white', 0, 0, 0, 5, 5, "0 5px 16px -3px black");
            this.filesMenu.set({
                    'backgroundColor': 'white',
                    'padding': 0,
                    'paddingTop' : 4,
                    'paddingBottom' : 4,
                    'decorator': decoratorWidgetMenu,
                    'marginLeft': 5,
                    'minWidth': 200,
                    'shadow' : false,
                    'blockerColor' : 'red'
            });

            var buttonFilesHome = new qx.ui.menu.Button(tr('Home'), 'eyeos/extern/images/22x22/places/user-home.png');
            buttonFilesHome.getChildControl('icon').set({
                'scale' : true,
                'height' : 22,
                'width' : 22
            });

			buttonFilesHome.set({
				'paddingTop': 7,
				'paddingBottom': 7
			});

            buttonFilesHome.addListener('execute', function(e) {
                var target = e.getTarget();
                eyeos.execute('files', this.getChecknum());
            }, this);
            this.filesMenu.add(buttonFilesHome);

            var buttonFilesDocuments = new qx.ui.menu.Button(tr('Documents'), 'eyeos/extern/images/22x22/places/folder-txt.png');
            buttonFilesDocuments.getChildControl('icon').set({
                'scale' : true,
                'height' : 22,
                'width' : 22
            });

			buttonFilesDocuments.set({
				'paddingTop': 7,
				'paddingBottom': 7
			});


            buttonFilesDocuments.addListener('execute', function(e) {
                var target = e.getTarget();
                eyeos.execute('files', this.getChecknum(), ['home:///Documents/']);
            }, this);
            this.filesMenu.add(buttonFilesDocuments);
            
            var buttonFilesImages = new qx.ui.menu.Button(tr('Images'), 'eyeos/extern/images/22x22/places/folder-image.png');
            buttonFilesImages.getChildControl('icon').set({
                'scale' : true,
                'height' : 22,
                'width' : 22
            });

			buttonFilesImages.set({
				'paddingTop': 7,
				'paddingBottom': 7
			});


            buttonFilesImages.addListener('execute', function(e) {
                var target = e.getTarget();
                eyeos.execute('files', this.getChecknum(), ['home:///Images/']);
            }, this);
            this.filesMenu.add(buttonFilesImages);

            var buttonFilesSharedByMe = new qx.ui.menu.Button(tr('Shared by me'), 'eyeos/extern/images/22x22/places/user-identity.png');
            buttonFilesSharedByMe.getChildControl('icon').set({
                'scale' : true,
                'height' : 22,
                'width' : 22
            });

			buttonFilesSharedByMe.set({
				'paddingTop': 7,
				'paddingBottom': 7
			});


            buttonFilesSharedByMe.addListener('execute', function(e) {
                var target = e.getTarget();
                eyeos.execute('files', this.getChecknum(), ['share://~' + eyeos.getCurrentUserName() + '/']);
            }, this);
            this.filesMenu.add(buttonFilesSharedByMe);

            var buttonFilesSharedByMyContacts = new qx.ui.menu.Button(tr('Shared by my contacts'), 'eyeos/extern/images/22x22/apps/system-users.png');
            buttonFilesSharedByMyContacts.getChildControl('icon').set({
                'scale' : true,
                'height' : 22,
                'width' : 22
            });

			buttonFilesSharedByMyContacts.set({
				'paddingTop': 7,
				'paddingBottom': 7
			});


            buttonFilesSharedByMyContacts.addListener('execute', function(e) {
                var target = e.getTarget();
                eyeos.execute('files', this.getChecknum(), ['share:///']);
            }, this);
            this.filesMenu.add(buttonFilesSharedByMyContacts);


            this.filesMenu.setOpener(filesBox);

            filesBox.addListener('click', function(e) {
                e.stopPropagation();
                this.filesMenu.open();
            }, this);


            // -------------------------------------

            //separator ----------------------------

            var separator = new qx.ui.basic.Image();
            separator.setSource('eyeos/extern/images/Separator.png');

            // -------------------------------------

            containTabs.add(filesBox);
            containTabs.add(separator);

            //people -----------------------

            var peopleBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());

            //izquierdo: 404040
            //derecho: 262626
            var peopleLabel = new qx.ui.basic.Label('People').set({
                value: '<span style="font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;"><strong>'+tr('People')+'</strong></span>',
                rich: true,
                marginTop: 6,
                marginLeft: 10,
                marginRight: 10,
                textColor: '#E5E5E5'
            });

            peopleLabel.addListener('mouseover', function() {
                peopleLabel.setTextColor('#57A4DF');
            });

            peopleLabel.addListener('mouseout', function() {
                peopleLabel.setTextColor('#E5E5E5');
            });

            peopleBox.add(peopleLabel, {'flex' : 1});

            this.peopleMenu = new qx.ui.menu.Menu();
           //desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px,
            this.peopleMenu.set({
                    'backgroundColor': 'white',
                    'padding': 0,
                    'paddingBottom' : 4,
                    'decorator': decoratorWidgetMenu,
                    'marginLeft': 5,
                    'minWidth': 200,
                    'shadow' : false,
                    'blockerColor' : 'red'
            });

			eyeos.messageBus.getInstance().addListener('eyeos_people_confirmContact', function() {
				var childrens = this.peopleMenu.getChildren();
				var toRemove = [];
				for(var i = 0; i < childrens.length; i++) {
					if(i > 0) {
						toRemove.push(childrens[i]);
					}
				}
				for(var i = 0;i < toRemove.length; i++) {
					this.peopleMenu.remove(toRemove[i]);
				}
				this.fillWithContacts();
				return;
			}, this);

			eyeos.messageBus.getInstance().addListener('eyeos_people_deleteContact', function() {
				var childrens = this.peopleMenu.getChildren();
				var toRemove = [];
				for(var i = 0; i < childrens.length; i++) {
					if(i > 0) {
						toRemove.push(childrens[i]);
					}
				}
				for(var i = 0;i < toRemove.length; i++) {
					this.peopleMenu.remove(toRemove[i]);
				}
				this.fillWithContacts();
				return;
			}, this);

			eyeos.messageBus.getInstance().addListener('eyeos_people_userConnected', function() {
				var childrens = this.peopleMenu.getChildren();
				var toRemove = [];
				for(var i = 0; i < childrens.length; i++) {
					if(i > 0) {
						toRemove.push(childrens[i]);
					}
				}
				for(var i = 0;i < toRemove.length; i++) {
					this.peopleMenu.remove(toRemove[i]);
				}
				this.fillWithContacts();
				return;
			}, this);

			eyeos.messageBus.getInstance().addListener('eyeos_people_userDisconnected', function() {
				var childrens = this.peopleMenu.getChildren();
				var toRemove = [];
				for(var i = 0; i < childrens.length; i++) {
					if(i > 0) {
						toRemove.push(childrens[i]);
					}
				}
				for(var i = 0;i < toRemove.length; i++) {
					this.peopleMenu.remove(toRemove[i]);
				}
				this.fillWithContacts();
				return;
			}, this);

            var searchBox = new qx.ui.menu.SearchBox('Home');

			searchBox.addListener('doSearch', function(e) {
				var text = e.getData();
				text = text.replace(/^\s*|\s*$/g,"");
				if(text == "" ) {
					var childrens = this.peopleMenu.getChildren();
					var toRemove = [];
					for(var i = 0; i < childrens.length; i++) {
						if(i > 0) {
							toRemove.push(childrens[i]);
						}
					}
					for(var i = 0;i < toRemove.length; i++) {
						this.peopleMenu.remove(toRemove[i]);
					}
					this.fillWithContacts();
					return;
				}
				
				eyeos.callMessage(this.getChecknum(), "searchPeople", text, function(e){
					var childrens = this.peopleMenu.getChildren();
					var toRemove = [];
					for(var i = 0; i < childrens.length; i++) {
						if(i > 0) {
							toRemove.push(childrens[i]);
						}
					}
					for(var i = 0;i < toRemove.length; i++) {
						this.peopleMenu.remove(toRemove[i]);
					}
					this.fillWithContacts(text);
					var delimiter = new qx.ui.menu.customMessage('Other people in this network');
					delimiter.addListener('mouseover', function(e) {
						e.stopPropagation();
					});

					this.peopleMenu.add(delimiter);
					for(var i=0; i<e.length; i++) {
						if(!e[i]['state'] || e[i]['state'] == 'pending') {
							var searchResult = new qx.ui.menu.Userbox();
							var username = e[i]['realName'];
							var icon = 'index.php?checknum=' + this.getChecknum() + '&message=__UserInfo_getAvatarPicture&params[userId]='+e[i]['userId'];
							
							if(e[i]['state'] == 'pending') {
								var actionIcon = 'eyeos/extern/images/Pending_contact.png';
							} else {
								var actionIcon = 'eyeos/extern/images/list-add-user.png';
								searchResult.addListener('executeAction', function(e) {
									var userId = this.getUserData('userId');
									var optionPane = new eyeos.dialogs.OptionPane(
										"<b>"+tr("Are you sure you want to add")+' '+this.getUserData('name')+' '+tr("as a contact?")+"</b>",
										eyeos.dialogs.OptionPane.QUESTION_MESSAGE,
										eyeos.dialogs.OptionPane.YES_NO_OPTION);
										var dialog = optionPane.createDialog(document.eyeDesktop, tr("Create new contact"), function(result) {
											if (result == 0) {
												var contactManager = eyeos.contacts.ContactManager.getInstance();
												this.setActionIcon('eyeos/extern/images/Pending_contact.png');
												contactManager.requestRelationship(userId, function () {});
											}
										}, this);
									dialog.open();
								});
							}

							searchResult.fill(username, icon, actionIcon, 140);
							searchResult.setUserData('userId', e[i]['userId']);
							searchResult.setUserData('name', e[i]['realName']);

							this.peopleMenu.add(searchResult);
						}
					}
				}, this);
			}, this);

            this.peopleMenu.add(searchBox);

			this.fillWithContacts();

            this.peopleMenu.setOpener(peopleBox);

            peopleBox.addListener('click', function(e) {
                e.stopPropagation();
                this.peopleMenu.open();
            }, this);

            // -------------------------------------

            //separator ----------------------------

            var separator = new qx.ui.basic.Image();
            separator.setSource('eyeos/extern/images/Separator.png');

            // -------------------------------------

            containTabs.add(peopleBox);
            containTabs.add(separator);

            //groups -----------------------

            var groupsBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());

            //izquierdo: 404040
            //derecho: 262626
            var groupsLabel = new qx.ui.basic.Label('Groups').set({
                value: '<span style="font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;"><strong>'+tr('Groups')+'</strong></span>',
                rich: true,
                marginTop: 6,
                marginLeft: 10,
                marginRight: 10,
                textColor: '#E5E5E5'
            });

            groupsLabel.addListener('mouseover', function() {
                groupsLabel.setTextColor('#57A4DF');
            });

            groupsLabel.addListener('mouseout', function() {
                groupsLabel.setTextColor('#E5E5E5');
            });

            groupsBox.add(groupsLabel,{'flex' : 1});

            this.groupsMenu = new qx.ui.menu.Menu();
           //desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px,
            this.groupsMenu.set({
                    'backgroundColor': 'white',
                    'padding': 0,
                    'paddingBottom' : 4,
                    'decorator': decoratorWidgetMenu,
                    'marginLeft': 5,
                    'minWidth': 300,
                    'shadow' : false,
                    'blockerColor' : 'red'
            });

            //18 de alto + 6 + 6 (paddings top y bottom) + 1px borde arriba y abajo
            var searchBoxGroup = new qx.ui.menu.SearchBox('Groups');

			eyeos.messageBus.getInstance().addListener('eyeos_workgroup_deleteGroup', function(e) {
				var childrens = this.groupsMenu.getChildren();
				var toRemove = [];
				for(var i = 0; i < childrens.length; i++) {
					if(i > 0) {
						toRemove.push(childrens[i]);
					}
				}
				for(var i = 0;i < toRemove.length; i++) {
					this.groupsMenu.remove(toRemove[i]);
				}

				this.fillWithGroups();
			}, this);

			searchBoxGroup.addListener('doSearch', function(e) {
				var text = e.getData();
				var childrens = this.groupsMenu.getChildren();
				var toRemove = [];
				for(var i = 0; i < childrens.length; i++) {
					if(i > 0) {
						toRemove.push(childrens[i]);
					}
				}
				for(var i = 0;i < toRemove.length; i++) {
					this.groupsMenu.remove(toRemove[i]);
				}
				if(text == "") {
					this.fillWithGroups();
				} else {
					this.fillWithGroups(text, function(e) {
						var delimiter = new qx.ui.menu.Button(tr('Other groups in this network'));
						delimiter.addListener('mouseover', function(e) {
							e.stopPropagation();
						});

						this.groupsMenu.addAt(delimiter);

						//now search other groups in the network
						eyeos.callMessage(this._checknum, '__Workgroups_searchWorkgroups', {
							pattern: text
						}, function (groups) {
							var myId = eyeos.getCurrentUserData().id;
							for (var i = 0; i < groups.length; ++i) {
									if ((groups[i]['workgroup'].privacyMode != eyeos.ui.tabs.GroupAll.PRIVACY_ONINVITATION)
										&& (groups[i].status == eyeos.ui.tabs.GroupAll.STATUS_NOT_MEMBER)
										&& (groups[i]['workgroup'].ownerId) != myId){


										//createMyGroupItem(groups[i]['workgroup'].name, groups[i]['workgroup'].id);
										var searchResult = new qx.ui.menu.Userbox();
										var icon = 'index.php?checknum=' + this.getChecknum() + '&message=__Workgroups_getWorkgroupPicture&params[workgroupId]=' + groups[i]['workgroup'].id + '&refresh=' + new Date().getTime();
										
										var actionIcon = 'eyeos/extern/images/16x16/actions/list-add.png';

										searchResult.fill(groups[i]['workgroup'].name, icon, actionIcon, 240);
										this.groupsMenu.add(searchResult);

										searchResult.setUserData('name', groups[i]['workgroup'].name);
										searchResult.setUserData('id', groups[i]['workgroup'].id);

										var self = this;
										
										searchResult.addListener('click', function(e) {

										});

										var self = this;
										searchResult.addListener('executeAction', function(e) {

											var op = new eyeos.dialogs.OptionPane(
													tr('Are you sure you want to join this workgroup?'),
													eyeos.dialogs.OptionPane.QUESTION_MESSAGE,
													eyeos.dialogs.OptionPane.YES_NO_OPTION);
												op.createDialog(
													null,
													tr('Join workgroup'),
													function (answer) {
														if (answer == eyeos.dialogs.OptionPane.YES_OPTION) {
															var params = {
																	workgroupId: this.getUserData('id')
															};
															eyeos.callMessage(self.getChecknum(), '__Workgroups_requestMembership', params, function (result) {
																var bus = eyeos.messageBus.getInstance();
																bus.send('workgroup', 'joinGroup', [this.getName(), this.getId()]);
															}, this);
														}
													},
													this, true
											).open();
										});
									}
							}
						}, this);


					}, this);
				}
			}, this);

			eyeos.messageBus.getInstance().addListener('eyeos_NSGroup_userWorkgroupAssignationCreated', function() {
					var childrens = this.groupsMenu.getChildren();
					var toRemove = [];
					for(var i = 0; i < childrens.length; i++) {
						if(i > 0) {
							toRemove.push(childrens[i]);
						}
					}
					for(var i = 0;i < toRemove.length; i++) {
						this.groupsMenu.remove(toRemove[i]);
					}
					this.fillWithGroups();
					return;
			}, this);

			eyeos.messageBus.getInstance().addListener('eyeos_NSGroup_confirmMembership', function() {
					var childrens = this.groupsMenu.getChildren();
					var toRemove = [];
					for(var i = 0; i < childrens.length; i++) {
						if(i > 0) {
							toRemove.push(childrens[i]);
						}
					}
					for(var i = 0;i < toRemove.length; i++) {
						this.groupsMenu.remove(toRemove[i]);
					}
					this.fillWithGroups();
					return;
			}, this);
			
			eyeos.messageBus.getInstance().addListener('eyeos_workgroup_createGroup', function() {
					var childrens = this.groupsMenu.getChildren();
					var toRemove = [];
					for(var i = 0; i < childrens.length; i++) {
						if(i > 0) {
							toRemove.push(childrens[i]);
						}
					}
					for(var i = 0;i < toRemove.length; i++) {
						this.groupsMenu.remove(toRemove[i]);
					}
					this.fillWithGroups();
					return;
			}, this);

			searchBoxGroup.addListener('createGroup', function(e) {
				var newWindow = new eyeos.ui.tabs.NewGroupWindow(this.getChecknum());

				var bus = eyeos.messageBus.getInstance();
				bus.addListener('eyeos_groups_newGroupWindowDone', function() {

				});
			}, this);


			
            this.groupsMenu.add(searchBoxGroup);

			this.fillWithGroups();

            this.groupsMenu.setOpener(groupsBox);

            groupsBox.addListener('click', function(e) {
                e.stopPropagation();
                this.groupsMenu.open();
            }, this);

            // -------------------------------------

            //separator ----------------------------

            var separator = new qx.ui.basic.Image();
            separator.setSource('eyeos/extern/images/Separator.png');

            // -------------------------------------

            containTabs.add(groupsBox);
            containTabs.add(separator);

            //add containTabs to eyeDesktop.
            //it is added to eyeDesktop instead of screen because tabs can be on top of windows.
            //window are places inside eyeDesktop because is the desktop manager.
            //the height 50% is because tabs fill half of the screen when displayed, not more.
            screen.addAt(containTabs, 0);
        },

		fillWithContacts : function(filter) {
            //now, fill with the contacts
            eyeos.contacts.ContactManager.getInstance().getAllContacts('accepted', function(e) {
				for(var i=0; i<e.length; i++) {
						var searchResult = new qx.ui.menu.Userbox();
						searchResult.setUserData('userId',e[i].getId());
						eyeos.contacts.ContactManager.getInstance().getContactsByIds([e[i].getId()], function (data) {
							searchResult.setUserData('userObject', data[0]);
						}, searchResult);
						searchResult.setUserData('name',e[i].getNickname());
						var username = e[i].getNickname();
						if(filter && username.indexOf(filter) == -1) {
							continue;
						}
						var icon = 'index.php?checknum=' + this.getChecknum() + '&message=__UserInfo_getAvatarPicture&params[userId]='+e[i].getId();
						var actionIcon = 'eyeos/extern/images/Delete_contact.png';
						searchResult.fill(username, icon, actionIcon, 140, e[i].getConnected());
						searchResult.addListener('executeAction', function(e) {
							var userId = this.getUserData('userId');
							var optionPane = new eyeos.dialogs.OptionPane(
								"<b>"+tr("Are you sure you want to delete")+' '+this.getUserData('name')+' '+tr("as a contact?")+"</b>",
								eyeos.dialogs.OptionPane.QUESTION_MESSAGE,
								eyeos.dialogs.OptionPane.YES_NO_OPTION);
								var dialog = optionPane.createDialog(document.eyeDesktop, tr("Delete a contact"), function(result) {
									if (result == 0) {
										var contactManager = eyeos.contacts.ContactManager.getInstance();
										this.destroy();
										contactManager.deleteContact(userId, function () {});
									}
								}, this);
							dialog.open();
						});
						var self = this;
						searchResult.addListener('click', function(e) {
							var username = this.getUserData('name');
							qx.ui.menu.Manager.getInstance().hideAll();
							eyeos.execute('files',self.getChecknum(), ['share://~'+username+'/']);
						});
						this.peopleMenu.add(searchResult);
				}
            }, this);
		},

		fillWithGroups : function(filter, callback, context) {
			eyeos.callMessage(this.getChecknum(), '__Workgroups_getAllWorkgroupsByUser', {
                includeMeta: 'true'
            }, function (groups) {
                for (var i = 0; i < groups.length; ++i) {
					//createMyGroupItem(groups[i]['workgroup'].name, groups[i]['workgroup'].id);
					var searchResult = new qx.ui.menu.Userbox();
					if(filter && groups[i]['workgroup'].name.indexOf(filter) == -1) {
						continue;
					}

					// If status is pending do not show the workgroup
					if (groups[i].status != 0) {
						continue;
					}
					var icon = 'index.php?checknum=' + this.getChecknum() + '&message=__Workgroups_getWorkgroupPicture&params[workgroupId]=' + groups[i]['workgroup'].id + '&refresh=' + new Date().getTime();
					var self = this;
					searchResult.setUserData('id', groups[i]['workgroup'].id);
					if (groups[i].role < 2) {
						var actionIcon = 'eyeos/extern/images/16x16/actions/configure.png';
						searchResult.addListener('executeAction', function(e) {
							qx.ui.menu.Manager.getInstance().hideAll();
							new eyeos.ui.tabs.GroupAdminWindow(self.getChecknum(), this.getUserData('id'));
						});
					} else {
						var actionIcon = 'eyeos/extern/images/Delete_contact.png';
						searchResult.addListener('executeAction', function(e) {
							var op = new eyeos.dialogs.OptionPane(
									tr('Are you sure you want to leave this workgroup?'),
									eyeos.dialogs.OptionPane.QUESTION_MESSAGE,
									eyeos.dialogs.OptionPane.YES_NO_OPTION);
								op.createDialog(
									null,
									tr('Join workgroup'),
									function (answer) {
										if (answer == eyeos.dialogs.OptionPane.YES_OPTION) {
											var params = {
												workgroupId: this.getUserData('id'),
												userIds: [eyeos.getCurrentUserData().id]
											};
											eyeos.callMessage(self.getChecknum(), '__Workgroups_deleteMemberships', params, function (result) {
												searchResult.destroy();
											}, this);
										}
									},
									this, true
							).open();
						});
					}

					searchResult.fill(groups[i]['workgroup'].name, icon, actionIcon, 240);
					this.groupsMenu.add(searchResult);

					searchResult.setUserData('name', groups[i]['workgroup'].name);

					var self = this;
					searchResult.addListener('click', function(e) {
						var group = this.getUserData('name');
						qx.ui.menu.Manager.getInstance().hideAll();
						eyeos.execute('files',self.getChecknum(), ['workgroup://~'+group+'/']);
					});
                }
				if (callback) {
					if (context) {
						callback.call(context);
					} else {
						callback();
					}
				}
            }, this);
		}
    }
});

qx.Class.define("qx.ui.menu.SearchBox", {
  extend : qx.ui.menu.Button,
  construct : function(label, icon, command, menu) {
    this.base(arguments);
        var decoratorSearch = new qx.ui.decoration.Background().set({
                backgroundImage: 'eyeos/extern/images/Search_background.png',
                backgroundRepeat: 'repeat-x'
        });
        this.setDecorator(decoratorSearch);
        this.set({
            height: 30
        });
        this.addListener('mouseover', function(e) {
            e.stopPropagation();
        }, this);

        this.addListener('mouseout', function(e) {
            e.stopPropagation();
        }, this);

        this.getChildControl('icon').destroy();
        this.getChildControl('label').destroy();
        this.searchField = new qx.ui.form.TextField();
        var decoratorWidgetMenu = new qx.ui.decoration.RoundBorderBeveled(null, 'white', 0, 10, 10, 10, 10);
        this.searchField.setDecorator(decoratorWidgetMenu);

        this.searchField.set({
            width: 180,
            backgroundColor: 'white',
            shadow: null
        });

		this.timer = new qx.event.Timer(500);
		this.searchField.addListener('input', function(e) {
			this.timer.stop();
			this.timer.start();
		}, this);

		this.timer.addListener('interval', function(e) {
			this.timer.stop();
			this.fireDataEvent('doSearch', this.searchField.getValue());
		}, this);

        this.searchField.setPlaceholder('Search...');

		this.searchField.addListener('appear', function(e) {
			this.searchField.focus();
		}, this);
        
        this.add(this.searchField , {column: 0});

		var buttonAdd = new qx.ui.form.Button(tr('Create group'));
		buttonAdd.set({
			marginLeft:170,
			shadow:null
		});

		buttonAdd.addListener('execute', function(e) {
			this.fireEvent('createGroup');
		}, this);
		this.add(buttonAdd, {column: 1});
  },

  members: {
		add : function(w, o) {
		  this._add(w, o);
		},

		_onMouseUp : function() {

		}
  }
});

qx.Class.define("qx.ui.menu.customMessage", {
  extend : qx.ui.menu.Button,
  construct : function(label, icon, command, menu) {
    arguments.callee.base.call(this, label, icon, command, menu);
  },

  members: {
		_onMouseUp : function() {

		}
  }
});

qx.Class.define("qx.ui.menu.Userbox", {
  extend : qx.ui.menu.Button,
  construct : function(label, icon, command, menu) {
    arguments.callee.base.call(this, label, icon, command, menu);
  },

  members: {
		add : function(w, o) {
			this._add(w, o);
		},

		_onMouseUp : function() {

		},

		fill : function(text, icon, actionIcon, marginLeft, status) {
				text = escapeHtml(text);
				var user = new qx.ui.basic.Label(text);
				user.set({
					padding:6,
					paddingLeft: 8,
					rich: true
				});
				var image = new qx.ui.basic.Image();
				image.set({
					'scale' : true,
					'height' : 22,
					'width' : 22
				});
				image.setSource(icon);

				this.actionImage = new qx.ui.basic.Image();
				this.actionImage.setSource(actionIcon);

				var composite = new qx.ui.container.Composite();
				composite.setLayout(new qx.ui.layout.Canvas());
				this.add(image,{column:0});
				this.add(composite,{column:1});
				composite.add(user, {left: 0});
				this.statusImage = new qx.ui.basic.Image();
				if(!status) {
					this.statusImage.exclude();
				} else {
					user.setValue('<span style="color:green;font-weight:bold">'+text+'</span>')
				}
				this.statusImage.setSource('eyeos/extern/images/16x16/actions/view-process-users.png');
				composite.add(this.statusImage, {left:marginLeft-22, top:5});
				composite.add(this.actionImage, {left: marginLeft, top:5});

				this.statusImage.addListener('click', function(e) {
					var dbus = eyeos.messageBus.getInstance();
					dbus.send('chat', 'requestchat', this.getUserData('userObject'));
					e.stopPropagation();
				}, this);

				this.addListener('mouseover', function(e) {
					this.getLayoutParent().setSelectedButton(this);
					e.stopPropagation();
				}, this);

				this.actionImage.addListener('click', function(e) {
					this.fireEvent('executeAction');
					e.stopPropagation();
				}, this);
		},

		setActionIcon : function(icon) {
			this.actionImage.setSource(icon);
		}
  }
});
topmenu_application(123709005, 2735, [0,[{"name":"session","displayName":"Session","app":"session","shortDescription":"","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Core","listable":0},{"name":"contactmanager","displayName":"Contact Manager","app":"contactmanager","shortDescription":"eyeOS Contact Manager","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"System","listable":0},{"name":"chat","displayName":"Chat","app":"chat","shortDescription":"Talk with your contacts","image":"index.php?extern=\/images\/22x22\/apps\/konversation.png","favorite":0,"lists":"Desktop","listable":1},{"name":"pdfviewer","displayName":"pdfviewer","app":"pdfviewer","shortDescription":"View pdf documents","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Desktop","listable":0},{"name":"viewer","displayName":"Viewer","app":"viewer","shortDescription":"View documents and play media files","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Desktop","listable":0},{"name":"newusersettings","displayName":"New User Settings","app":"newusersettings","shortDescription":"User Settings","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Utils","listable":0},{"name":"imageviewer","displayName":"imageviewer","app":"imageviewer","shortDescription":"View image documents","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Desktop","listable":0},{"name":"iframize","displayName":"Iframize","app":"iframize","shortDescription":"Iframize resources","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-user.png","favorite":0,"lists":"Desktop","listable":0},{"name":"calendar","displayName":"Calendar","app":"calendar","shortDescription":"Organize your planning and share events with people","image":"index.php?extern=\/images\/22x22\/actions\/view-pim-calendar.png","favorite":1,"lists":"Office","listable":1},{"name":"addressbook","displayName":"Addressbook","app":"addressbook","shortDescription":"addressbook to manage contacts","image":"index.php?extern=\/images\/22x22\/apps\/office-address-book.png","favorite":0,"lists":"Mail","listable":0},{"name":"toptabs","displayName":"toptabs","app":"toptabs","shortDescription":"toptabs","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Desktop","listable":0},{"name":"urlshare","displayName":"URLShare","app":"urlshare","shortDescription":"Share files by URL","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-user.png","favorite":0,"lists":"Desktop","listable":0},{"name":"runas","displayName":"Run As","app":"runas","shortDescription":"Run an application as a different user","image":"index.php?extern=\/images\/22x22\/status\/dialog-password.png","favorite":0,"lists":"Utils","listable":0},{"name":"login","displayName":"Login","app":"login","shortDescription":"","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Core","listable":0},{"name":"download","displayName":"Download","app":"download","shortDescription":"Download files to local system","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"System","listable":0},{"name":"logout","displayName":"Logout","app":"logout","shortDescription":"","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Code","listable":0},{"name":"upload","displayName":"Upload","app":"upload","shortDescription":"Upload files","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-user.png","favorite":0,"lists":"Desktop","listable":0},{"name":"files","displayName":"File Manager","app":"files","shortDescription":"Access and manage your files","image":"index.php?extern=\/images\/22x22\/apps\/system-file-manager.png","favorite":1,"lists":"Desktop","listable":1},{"name":"howto","displayName":"How to use eyeOS","app":"howto","shortDescription":"Help with the first steps with eyeOS","image":"index.php?extern=\/images\/22x22\/categories\/system-help.png","favorite":0,"lists":"Desktop","listable":1},{"name":"topmenu","displayName":"topmenu","app":"topmenu","shortDescription":"topmenu","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Desktop","listable":0},{"name":"welcomepage","displayName":"Welcome Page","app":"welcomepage","shortDescription":"Page with a introduction of eyeOS","image":"index.php?extern=\/images\/22x22\/apps\/welcome-manual.png","favorite":0,"lists":"Desktop","listable":1},{"name":"netsync","displayName":"NetSync","app":"netsync","shortDescription":"","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Core","listable":0},{"name":"notepad","displayName":"Notepad","app":"notepad","shortDescription":"A very simple text editor","image":"index.php?extern=\/images\/22x22\/apps\/scribus.png","favorite":1,"lists":"Utils","listable":1},{"name":"calculator","displayName":"Calculator","app":"calculator","shortDescription":"A calculator","image":"index.php?extern=\/images\/22x22\/apps\/accessories-calculator.png","favorite":1,"lists":"Utils","listable":1},{"name":"openwith","displayName":"OpenWith","app":"openwith","shortDescription":"Open With utility","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Core","listable":0},{"name":"rmail","displayName":"Mail Client","app":"rmail","shortDescription":"Read and write e-mails","image":"index.php?extern=\/images\/22x22\/apps\/internet-mail.png","favorite":0,"lists":"Code","listable":1},{"name":"taskbar","displayName":"taskbar","app":"taskbar","shortDescription":"taskbar","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Desktop","listable":0},{"name":"sysmon","displayName":"SysMon","app":"sysmon","shortDescription":"System monitor","image":"index.php?extern=\/images\/22x22\/apps\/utilities-system-monitor.png","favorite":0,"lists":"Utils","listable":1},{"name":"desktop","displayName":"Desktop","app":"desktop","shortDescription":"","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Core","listable":0},{"name":"newlink","displayName":"newLink","app":"newlink","shortDescription":"newLink","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-user.png","favorite":0,"lists":"Desktop","listable":0},{"name":"documents","displayName":"Documents","app":"documents","shortDescription":"Create office documents","image":"index.php?extern=\/images\/22x22\/apps\/okteta.png","favorite":1,"lists":"Office","listable":1},{"name":"docviewer","displayName":"docviewer","app":"docviewer","shortDescription":"View pdf documents","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Desktop","listable":0},{"name":"about","displayName":"about","app":"about","shortDescription":"About eyeOS","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Dev","listable":0},{"name":"openlink","displayName":"openlink","app":"openlink","shortDescription":"open resources link into iframize","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-user.png","favorite":0,"lists":"Desktop","listable":0},{"name":"init","displayName":"Init","app":"init","shortDescription":"","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Core","listable":0},{"name":"events","displayName":"Events","app":"events","shortDescription":"","image":"index.php?extern=\/images\/22x22\/apps\/preferences-desktop-default-applications.png","favorite":0,"lists":"Code","listable":0}]]);eyeos._callbackProxyWithContent(null, null, null, {"__eyeos_specialControlMessage_header":"__control_enhancedData","__eyeos_specialControlMessage_body":{"messages":[{"type":"application","eventName":"start","eventData":{"name":"topmenu","pid":2735,"loginContext":{"user":"username","group":"users"},"checknum":123709005,"time":1318409260,"args":{}}}],"data":"lang['Applications'] = 'Applications';\nlang['Files'] = 'Files';\nlang['People'] = 'People';\nlang['Home'] = 'Home';\nlang['Documents']='Documents';\nlang['Images']='Images';\nlang['Shared by me']='Shared by me';\nlang['Shared by my contacts']='Shared by my contacts';\nlang['Create new contact']='Create new contact';\nlang['Groups']='Groups';\nlang['Other groups in this network']='Other groups in this network';\nlang['Are you sure you want to join this workgroup?']='Are you sure you want to join this workgroup?';\nlang['Join workgroup']='Join workgroup';\nlang['Delete a contact']='Delete a contact';\nlang['Are you sure you want to add']='Are you sure you want to add';\nlang['as a contact?']='as a contact?';\nlang['Are you sure you want to delete']='Are you sure you want to delete';\nlang['Are you sure you want to leave this workgroup?']='Are you sure you want to leave this workgroup?';\nlang['Join workgroup']='Join workgroup';\nlang['Create group']='Create group';\n\n\n\/*\n*                 eyeos - The Open Source Cloud's Web Desktop\n*                               Version 2.0\n*                   Copyright (C) 2007 - 2010 eyeos Team\n*\n* This program is free software; you can redistribute it and\/or modify it under\n* the terms of the GNU Affero General Public License version 3 as published by the\n* Free Software Foundation.\n*\n* This program is distributed in the hope that it will be useful, but WITHOUT\n* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n* FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more\n* details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* version 3 along with this program in the file \"LICENSE\".  If not, see\n* <http:\/\/www.gnu.org\/licenses\/agpl-3.0.txt>.\n*\n* See www.eyeos.org for more details. All requests should be sent to licensing@eyeos.org\n*\n* The interactive user interfaces in modified source and object code versions\n* of this program must display Appropriate Legal Notices, as required under\n* Section 5 of the GNU Affero General Public License version 3.\n*\n* In accordance with Section 7(b) of the GNU Affero General Public License version 3,\n* these Appropriate Legal Notices must retain the display of the \"Powered by\n* eyeos\" logo and retain the original copyright notice. If the display of the\n* logo is not reasonably feasible for technical reasons, the Appropriate Legal Notices\n* must display the words \"Powered by eyeos\" and retain the original copyright notice.\n*\/\n\nfunction topmenu_application(checknum, pid, args) {\n    var application = new eyeos.application.Topmenu(checknum, pid);\n    application.initApplication(checknum, args);\n}\n\nqx.Class.define('eyeos.application.Topmenu', {\n    extend: eyeos.system.EyeApplication,\n\n    construct: function (checknum, pid) {\n        arguments.callee.base.call(this, 'topmenu', checknum, pid);\n    },\n\n    properties: {\n\n    },\n\n    members: {\n        initApplication: function(checknum, args) {\n            var bus = eyeos.messageBus.getInstance();\n            var user = bus.retrieve('user');\n            var screen = bus.retrieve('screen');\n            var eyeDesktop = bus.retrieve('eyeDesktop');\n\n            var isAdmin = args[0];\n            var apps = args[1];\n            var decoratorTopmenu = new qx.ui.decoration.Background().set({\n                    backgroundImage: 'eyeos\/extern\/images\/Top_bar.png'\n                    \/\/backgroundRepeat: 'scale'\n            });\n            \/\/\tContainer TabView\n            var containTabs = new qx.ui.container.Composite(new qx.ui.layout.HBox());\n            containTabs.setDecorator(decoratorTopmenu);\n            containTabs.set ({\n                'zIndex' : 500002,\n                'height' : 32\n            });\n\n            \/\/applications -----------------------\n\n            var applicationsBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());\n\n            \/\/izquierdo: 404040\n            \/\/derecho: 262626\n            var applicationsLabel = new qx.ui.basic.Label('Applications').set({\n                value: '<span style=\"font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;\"><strong>'+tr('Applications')+'<\/strong><\/span>',\n                rich: true,\n                marginTop: 6,\n                marginLeft: 10,\n                marginRight: 10,\n                textColor: '#E5E5E5'\n            });\n\n            applicationsLabel.addListener('mouseover', function() {\n                applicationsLabel.setTextColor('#57A4DF');\n            });\n\n            applicationsLabel.addListener('mouseout', function() {\n                applicationsLabel.setTextColor('#E5E5E5');\n            });\n\n            applicationsBox.add(applicationsLabel,{'flex' : 1});\n\n\n            this.appsMenu = new qx.ui.menu.Menu();\n\n            \/\/desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px, \n            var decoratorWidgetMenu = new qx.ui.decoration.RoundBorderBeveled(null, 'white', 0, 0, 0, 5, 5, \"0 5px 16px -3px black\");\n            this.appsMenu.set({\n                    'backgroundColor': 'white',\n                    'padding': 0,\n                    'paddingTop' : 4,\n                    'paddingBottom' : 4,\n                    'decorator': decoratorWidgetMenu,\n                    'marginLeft': 5,\n                    'minWidth': 200,\n                    'shadow' : false,\n                    'blockerColor' : 'red'\n            });\n\t\t\tvar firstApps = [];\n\t\t\tvar order = ['files', 'documents', 'calendar', 'rmail', 'notepad', 'calculator', 'sysmon'];\n\t\t\torder.reverse();\n\t\t\t\n\t\t\tfor(var i = 0; i < apps.length; i++) {\n\t\t\t\tfor(var x = 0; x < order.length; x++) {\n\t\t\t\t\tif(apps[i].name == order[x]) {\n\t\t\t\t\t\tfirstApps[x] = apps[i];\n\t\t\t\t\t\tapps.splice(i, 1);\n                        break;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(var i in firstApps) {\n\t\t\t\tapps.unshift(firstApps[i]);\n\t\t\t}\n\n            for(var i in apps) {\n                if(apps[i].listable) {\n                    var buttonApp = new qx.ui.menu.Button(apps[i].displayName, apps[i].image);\n                    buttonApp.getChildControl('icon').set({\n                        'scale' : true,\n                        'height' : 22,\n                        'width' : 22\n                    });\n\n\t\t\t\t\tbuttonApp.set({\n\t\t\t\t\t\t'paddingTop': 7,\n\t\t\t\t\t\t'paddingBottom': 7\n\t\t\t\t\t});\n\n                    buttonApp.setUserData('appName', apps[i].name);\n                    buttonApp.addListener('execute', function(e) {\n                        var target = e.getTarget();\n                        eyeos.execute(target.getUserData('appName'), this.getChecknum());\n                    }, this);\n\n\t\t\t\t\tbuttonApp.setDraggable(true);\n\n\t\t\t\t\tbuttonApp.addListener('dragstart', function(e) {\n\t\t\t\t\t\tvar x = e.getDocumentLeft();\n\t\t\t\t\t\tvar y = e.getDocumentTop();\n\t\t\t\t\t\ty = y - 20;\n\t\t\t\t\t\tx = x + 11;\n\t\t\t\t\t\tthis.clipImage = e.getTarget().getChildControl('icon').clone();\n\t\t\t\t\t\tthis.clipImage.set({\n\t\t\t\t\t\t\t'scale': true,\n\t\t\t\t\t\t\t'height': 42,\n\t\t\t\t\t\t\t'width' : 42\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdocument.eyeDesktop.add(this.clipImage);\n\t\t\t\t\t\tthis.clipImage.set({\n\t\t\t\t\t\t\tzIndex: 100003\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.clipImage.setMarginTop(y);\n\t\t\t\t\t\tthis.clipImage.setMarginLeft(x);\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}, this);\n\n\t\t\t\t\tbuttonApp.addListener('drag', function(e) {\n\t\t\t\t\t\tvar x = e.getDocumentLeft();\n\t\t\t\t\t\tvar y = e.getDocumentTop();\n\t\t\t\t\t\ty = y - 20;\n\t\t\t\t\t\tx = x + 11;\n\t\t\t\t\t\tthis.clipImage.setMarginTop(y);\n\t\t\t\t\t\tthis.clipImage.setMarginLeft(x);\n\t\t\t\t\t}, this);\n\n\t\t\t\t\tbuttonApp.addListener('dragend', function(e) {\n\t\t\t\t\t\tthis.clipImage.destroy();\n\t\t\t\t\t}, this);\n                    this.appsMenu.add(buttonApp);\n                }\n            }\n            \n            this.appsMenu.setOpener(applicationsBox);\n\n            applicationsBox.addListener('click', function(e) {\n                e.stopPropagation();\n                this.appsMenu.open();\n            }, this);\n            \n\n            \/\/ -------------------------------------\n\n            \/\/separator ----------------------------\n\n            var separator = new qx.ui.basic.Image();\n            separator.setSource('eyeos\/extern\/images\/Separator.png');\n\n            \/\/ -------------------------------------\n\n            containTabs.add(applicationsBox);\n            containTabs.add(separator);\n\n            \/\/files -----------------------\n\n            var filesBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());\n\n            \/\/izquierdo: 404040\n            \/\/derecho: 262626\n            var filesLabel = new qx.ui.basic.Label('Files').set({\n                value: '<span style=\"font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;\"><strong>'+tr('Files')+'<\/strong><\/span>',\n                rich: true,\n                marginTop: 6,\n                marginLeft: 10,\n                marginRight: 10,\n                textColor: '#E5E5E5'\n            });\n\n            filesLabel.addListener('mouseover', function() {\n                filesLabel.setTextColor('#57A4DF');\n            });\n\n            filesLabel.addListener('mouseout', function() {\n                filesLabel.setTextColor('#E5E5E5');\n            });\n\n            filesBox.add(filesLabel,{'flex' : 1});\n\n            this.filesMenu = new qx.ui.menu.Menu();\n\n            \/\/desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px,\n            var decoratorWidgetMenu = new qx.ui.decoration.RoundBorderBeveled(null, 'white', 0, 0, 0, 5, 5, \"0 5px 16px -3px black\");\n            this.filesMenu.set({\n                    'backgroundColor': 'white',\n                    'padding': 0,\n                    'paddingTop' : 4,\n                    'paddingBottom' : 4,\n                    'decorator': decoratorWidgetMenu,\n                    'marginLeft': 5,\n                    'minWidth': 200,\n                    'shadow' : false,\n                    'blockerColor' : 'red'\n            });\n\n            var buttonFilesHome = new qx.ui.menu.Button(tr('Home'), 'eyeos\/extern\/images\/22x22\/places\/user-home.png');\n            buttonFilesHome.getChildControl('icon').set({\n                'scale' : true,\n                'height' : 22,\n                'width' : 22\n            });\n\n\t\t\tbuttonFilesHome.set({\n\t\t\t\t'paddingTop': 7,\n\t\t\t\t'paddingBottom': 7\n\t\t\t});\n\n            buttonFilesHome.addListener('execute', function(e) {\n                var target = e.getTarget();\n                eyeos.execute('files', this.getChecknum());\n            }, this);\n            this.filesMenu.add(buttonFilesHome);\n\n            var buttonFilesDocuments = new qx.ui.menu.Button(tr('Documents'), 'eyeos\/extern\/images\/22x22\/places\/folder-txt.png');\n            buttonFilesDocuments.getChildControl('icon').set({\n                'scale' : true,\n                'height' : 22,\n                'width' : 22\n            });\n\n\t\t\tbuttonFilesDocuments.set({\n\t\t\t\t'paddingTop': 7,\n\t\t\t\t'paddingBottom': 7\n\t\t\t});\n\n\n            buttonFilesDocuments.addListener('execute', function(e) {\n                var target = e.getTarget();\n                eyeos.execute('files', this.getChecknum(), ['home:\/\/\/Documents\/']);\n            }, this);\n            this.filesMenu.add(buttonFilesDocuments);\n            \n            var buttonFilesImages = new qx.ui.menu.Button(tr('Images'), 'eyeos\/extern\/images\/22x22\/places\/folder-image.png');\n            buttonFilesImages.getChildControl('icon').set({\n                'scale' : true,\n                'height' : 22,\n                'width' : 22\n            });\n\n\t\t\tbuttonFilesImages.set({\n\t\t\t\t'paddingTop': 7,\n\t\t\t\t'paddingBottom': 7\n\t\t\t});\n\n\n            buttonFilesImages.addListener('execute', function(e) {\n                var target = e.getTarget();\n                eyeos.execute('files', this.getChecknum(), ['home:\/\/\/Images\/']);\n            }, this);\n            this.filesMenu.add(buttonFilesImages);\n\n            var buttonFilesSharedByMe = new qx.ui.menu.Button(tr('Shared by me'), 'eyeos\/extern\/images\/22x22\/places\/user-identity.png');\n            buttonFilesSharedByMe.getChildControl('icon').set({\n                'scale' : true,\n                'height' : 22,\n                'width' : 22\n            });\n\n\t\t\tbuttonFilesSharedByMe.set({\n\t\t\t\t'paddingTop': 7,\n\t\t\t\t'paddingBottom': 7\n\t\t\t});\n\n\n            buttonFilesSharedByMe.addListener('execute', function(e) {\n                var target = e.getTarget();\n                eyeos.execute('files', this.getChecknum(), ['share:\/\/~' + eyeos.getCurrentUserName() + '\/']);\n            }, this);\n            this.filesMenu.add(buttonFilesSharedByMe);\n\n            var buttonFilesSharedByMyContacts = new qx.ui.menu.Button(tr('Shared by my contacts'), 'eyeos\/extern\/images\/22x22\/apps\/system-users.png');\n            buttonFilesSharedByMyContacts.getChildControl('icon').set({\n                'scale' : true,\n                'height' : 22,\n                'width' : 22\n            });\n\n\t\t\tbuttonFilesSharedByMyContacts.set({\n\t\t\t\t'paddingTop': 7,\n\t\t\t\t'paddingBottom': 7\n\t\t\t});\n\n\n            buttonFilesSharedByMyContacts.addListener('execute', function(e) {\n                var target = e.getTarget();\n                eyeos.execute('files', this.getChecknum(), ['share:\/\/\/']);\n            }, this);\n            this.filesMenu.add(buttonFilesSharedByMyContacts);\n\n\n            this.filesMenu.setOpener(filesBox);\n\n            filesBox.addListener('click', function(e) {\n                e.stopPropagation();\n                this.filesMenu.open();\n            }, this);\n\n\n            \/\/ -------------------------------------\n\n            \/\/separator ----------------------------\n\n            var separator = new qx.ui.basic.Image();\n            separator.setSource('eyeos\/extern\/images\/Separator.png');\n\n            \/\/ -------------------------------------\n\n            containTabs.add(filesBox);\n            containTabs.add(separator);\n\n            \/\/people -----------------------\n\n            var peopleBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());\n\n            \/\/izquierdo: 404040\n            \/\/derecho: 262626\n            var peopleLabel = new qx.ui.basic.Label('People').set({\n                value: '<span style=\"font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;\"><strong>'+tr('People')+'<\/strong><\/span>',\n                rich: true,\n                marginTop: 6,\n                marginLeft: 10,\n                marginRight: 10,\n                textColor: '#E5E5E5'\n            });\n\n            peopleLabel.addListener('mouseover', function() {\n                peopleLabel.setTextColor('#57A4DF');\n            });\n\n            peopleLabel.addListener('mouseout', function() {\n                peopleLabel.setTextColor('#E5E5E5');\n            });\n\n            peopleBox.add(peopleLabel, {'flex' : 1});\n\n            this.peopleMenu = new qx.ui.menu.Menu();\n           \/\/desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px,\n            this.peopleMenu.set({\n                    'backgroundColor': 'white',\n                    'padding': 0,\n                    'paddingBottom' : 4,\n                    'decorator': decoratorWidgetMenu,\n                    'marginLeft': 5,\n                    'minWidth': 200,\n                    'shadow' : false,\n                    'blockerColor' : 'red'\n            });\n\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_people_confirmContact', function() {\n\t\t\t\tvar childrens = this.peopleMenu.getChildren();\n\t\t\t\tvar toRemove = [];\n\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\tthis.peopleMenu.remove(toRemove[i]);\n\t\t\t\t}\n\t\t\t\tthis.fillWithContacts();\n\t\t\t\treturn;\n\t\t\t}, this);\n\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_people_deleteContact', function() {\n\t\t\t\tvar childrens = this.peopleMenu.getChildren();\n\t\t\t\tvar toRemove = [];\n\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\tthis.peopleMenu.remove(toRemove[i]);\n\t\t\t\t}\n\t\t\t\tthis.fillWithContacts();\n\t\t\t\treturn;\n\t\t\t}, this);\n\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_people_userConnected', function() {\n\t\t\t\tvar childrens = this.peopleMenu.getChildren();\n\t\t\t\tvar toRemove = [];\n\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\tthis.peopleMenu.remove(toRemove[i]);\n\t\t\t\t}\n\t\t\t\tthis.fillWithContacts();\n\t\t\t\treturn;\n\t\t\t}, this);\n\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_people_userDisconnected', function() {\n\t\t\t\tvar childrens = this.peopleMenu.getChildren();\n\t\t\t\tvar toRemove = [];\n\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\tthis.peopleMenu.remove(toRemove[i]);\n\t\t\t\t}\n\t\t\t\tthis.fillWithContacts();\n\t\t\t\treturn;\n\t\t\t}, this);\n\n            var searchBox = new qx.ui.menu.SearchBox('Home');\n\n\t\t\tsearchBox.addListener('doSearch', function(e) {\n\t\t\t\tvar text = e.getData();\n\t\t\t\ttext = text.replace(\/^\\s*|\\s*$\/g,\"\");\n\t\t\t\tif(text == \"\" ) {\n\t\t\t\t\tvar childrens = this.peopleMenu.getChildren();\n\t\t\t\t\tvar toRemove = [];\n\t\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\t\tthis.peopleMenu.remove(toRemove[i]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.fillWithContacts();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\teyeos.callMessage(this.getChecknum(), \"searchPeople\", text, function(e){\n\t\t\t\t\tvar childrens = this.peopleMenu.getChildren();\n\t\t\t\t\tvar toRemove = [];\n\t\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\t\tthis.peopleMenu.remove(toRemove[i]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.fillWithContacts(text);\n\t\t\t\t\tvar delimiter = new qx.ui.menu.customMessage('Other people in this network');\n\t\t\t\t\tdelimiter.addListener('mouseover', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.peopleMenu.add(delimiter);\n\t\t\t\t\tfor(var i=0; i<e.length; i++) {\n\t\t\t\t\t\tif(!e[i]['state'] || e[i]['state'] == 'pending') {\n\t\t\t\t\t\t\tvar searchResult = new qx.ui.menu.Userbox();\n\t\t\t\t\t\t\tvar username = e[i]['realName'];\n\t\t\t\t\t\t\tvar icon = 'index.php?checknum=' + this.getChecknum() + '&message=__UserInfo_getAvatarPicture&params[userId]='+e[i]['userId'];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(e[i]['state'] == 'pending') {\n\t\t\t\t\t\t\t\tvar actionIcon = 'eyeos\/extern\/images\/Pending_contact.png';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar actionIcon = 'eyeos\/extern\/images\/list-add-user.png';\n\t\t\t\t\t\t\t\tsearchResult.addListener('executeAction', function(e) {\n\t\t\t\t\t\t\t\t\tvar userId = this.getUserData('userId');\n\t\t\t\t\t\t\t\t\tvar optionPane = new eyeos.dialogs.OptionPane(\n\t\t\t\t\t\t\t\t\t\t\"<b>\"+tr(\"Are you sure you want to add\")+' '+this.getUserData('name')+' '+tr(\"as a contact?\")+\"<\/b>\",\n\t\t\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.QUESTION_MESSAGE,\n\t\t\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.YES_NO_OPTION);\n\t\t\t\t\t\t\t\t\t\tvar dialog = optionPane.createDialog(document.eyeDesktop, tr(\"Create new contact\"), function(result) {\n\t\t\t\t\t\t\t\t\t\t\tif (result == 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar contactManager = eyeos.contacts.ContactManager.getInstance();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.setActionIcon('eyeos\/extern\/images\/Pending_contact.png');\n\t\t\t\t\t\t\t\t\t\t\t\tcontactManager.requestRelationship(userId, function () {});\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t\t\t\tdialog.open();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tsearchResult.fill(username, icon, actionIcon, 140);\n\t\t\t\t\t\t\tsearchResult.setUserData('userId', e[i]['userId']);\n\t\t\t\t\t\t\tsearchResult.setUserData('name', e[i]['realName']);\n\n\t\t\t\t\t\t\tthis.peopleMenu.add(searchResult);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t}, this);\n\n            this.peopleMenu.add(searchBox);\n\n\t\t\tthis.fillWithContacts();\n\n            this.peopleMenu.setOpener(peopleBox);\n\n            peopleBox.addListener('click', function(e) {\n                e.stopPropagation();\n                this.peopleMenu.open();\n            }, this);\n\n            \/\/ -------------------------------------\n\n            \/\/separator ----------------------------\n\n            var separator = new qx.ui.basic.Image();\n            separator.setSource('eyeos\/extern\/images\/Separator.png');\n\n            \/\/ -------------------------------------\n\n            containTabs.add(peopleBox);\n            containTabs.add(separator);\n\n            \/\/groups -----------------------\n\n            var groupsBox = new qx.ui.container.Composite(new qx.ui.layout.HBox());\n\n            \/\/izquierdo: 404040\n            \/\/derecho: 262626\n            var groupsLabel = new qx.ui.basic.Label('Groups').set({\n                value: '<span style=\"font-family:Arial;font-size:13px;text-shadow: black 0px -1px 0px;\"><strong>'+tr('Groups')+'<\/strong><\/span>',\n                rich: true,\n                marginTop: 6,\n                marginLeft: 10,\n                marginRight: 10,\n                textColor: '#E5E5E5'\n            });\n\n            groupsLabel.addListener('mouseover', function() {\n                groupsLabel.setTextColor('#57A4DF');\n            });\n\n            groupsLabel.addListener('mouseout', function() {\n                groupsLabel.setTextColor('#E5E5E5');\n            });\n\n            groupsBox.add(groupsLabel,{'flex' : 1});\n\n            this.groupsMenu = new qx.ui.menu.Menu();\n           \/\/desplazamiento 4px abajo, 270 grados, color negro 80%, dispersion 9px,\n            this.groupsMenu.set({\n                    'backgroundColor': 'white',\n                    'padding': 0,\n                    'paddingBottom' : 4,\n                    'decorator': decoratorWidgetMenu,\n                    'marginLeft': 5,\n                    'minWidth': 300,\n                    'shadow' : false,\n                    'blockerColor' : 'red'\n            });\n\n            \/\/18 de alto + 6 + 6 (paddings top y bottom) + 1px borde arriba y abajo\n            var searchBoxGroup = new qx.ui.menu.SearchBox('Groups');\n\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_workgroup_deleteGroup', function(e) {\n\t\t\t\tvar childrens = this.groupsMenu.getChildren();\n\t\t\t\tvar toRemove = [];\n\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\tthis.groupsMenu.remove(toRemove[i]);\n\t\t\t\t}\n\n\t\t\t\tthis.fillWithGroups();\n\t\t\t}, this);\n\n\t\t\tsearchBoxGroup.addListener('doSearch', function(e) {\n\t\t\t\tvar text = e.getData();\n\t\t\t\tvar childrens = this.groupsMenu.getChildren();\n\t\t\t\tvar toRemove = [];\n\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\tthis.groupsMenu.remove(toRemove[i]);\n\t\t\t\t}\n\t\t\t\tif(text == \"\") {\n\t\t\t\t\tthis.fillWithGroups();\n\t\t\t\t} else {\n\t\t\t\t\tthis.fillWithGroups(text, function(e) {\n\t\t\t\t\t\tvar delimiter = new qx.ui.menu.Button(tr('Other groups in this network'));\n\t\t\t\t\t\tdelimiter.addListener('mouseover', function(e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.groupsMenu.addAt(delimiter);\n\n\t\t\t\t\t\t\/\/now search other groups in the network\n\t\t\t\t\t\teyeos.callMessage(this._checknum, '__Workgroups_searchWorkgroups', {\n\t\t\t\t\t\t\tpattern: text\n\t\t\t\t\t\t}, function (groups) {\n\t\t\t\t\t\t\tvar myId = eyeos.getCurrentUserData().id;\n\t\t\t\t\t\t\tfor (var i = 0; i < groups.length; ++i) {\n\t\t\t\t\t\t\t\t\tif ((groups[i]['workgroup'].privacyMode != eyeos.ui.tabs.GroupAll.PRIVACY_ONINVITATION)\n\t\t\t\t\t\t\t\t\t\t&& (groups[i].status == eyeos.ui.tabs.GroupAll.STATUS_NOT_MEMBER)\n\t\t\t\t\t\t\t\t\t\t&& (groups[i]['workgroup'].ownerId) != myId){\n\n\n\t\t\t\t\t\t\t\t\t\t\/\/createMyGroupItem(groups[i]['workgroup'].name, groups[i]['workgroup'].id);\n\t\t\t\t\t\t\t\t\t\tvar searchResult = new qx.ui.menu.Userbox();\n\t\t\t\t\t\t\t\t\t\tvar icon = 'index.php?checknum=' + this.getChecknum() + '&message=__Workgroups_getWorkgroupPicture&params[workgroupId]=' + groups[i]['workgroup'].id + '&refresh=' + new Date().getTime();\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tvar actionIcon = 'eyeos\/extern\/images\/16x16\/actions\/list-add.png';\n\n\t\t\t\t\t\t\t\t\t\tsearchResult.fill(groups[i]['workgroup'].name, icon, actionIcon, 240);\n\t\t\t\t\t\t\t\t\t\tthis.groupsMenu.add(searchResult);\n\n\t\t\t\t\t\t\t\t\t\tsearchResult.setUserData('name', groups[i]['workgroup'].name);\n\t\t\t\t\t\t\t\t\t\tsearchResult.setUserData('id', groups[i]['workgroup'].id);\n\n\t\t\t\t\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tsearchResult.addListener('click', function(e) {\n\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t\t\t\t\tsearchResult.addListener('executeAction', function(e) {\n\n\t\t\t\t\t\t\t\t\t\t\tvar op = new eyeos.dialogs.OptionPane(\n\t\t\t\t\t\t\t\t\t\t\t\t\ttr('Are you sure you want to join this workgroup?'),\n\t\t\t\t\t\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.QUESTION_MESSAGE,\n\t\t\t\t\t\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.YES_NO_OPTION);\n\t\t\t\t\t\t\t\t\t\t\t\top.createDialog(\n\t\t\t\t\t\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttr('Join workgroup'),\n\t\t\t\t\t\t\t\t\t\t\t\t\tfunction (answer) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (answer == eyeos.dialogs.OptionPane.YES_OPTION) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tworkgroupId: this.getUserData('id')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teyeos.callMessage(self.getChecknum(), '__Workgroups_requestMembership', params, function (result) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar bus = eyeos.messageBus.getInstance();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbus.send('workgroup', 'joinGroup', [this.getName(), this.getId()]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis, true\n\t\t\t\t\t\t\t\t\t\t\t).open();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this);\n\n\n\t\t\t\t\t}, this);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_NSGroup_userWorkgroupAssignationCreated', function() {\n\t\t\t\t\tvar childrens = this.groupsMenu.getChildren();\n\t\t\t\t\tvar toRemove = [];\n\t\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\t\tthis.groupsMenu.remove(toRemove[i]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.fillWithGroups();\n\t\t\t\t\treturn;\n\t\t\t}, this);\n\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_NSGroup_confirmMembership', function() {\n\t\t\t\t\tvar childrens = this.groupsMenu.getChildren();\n\t\t\t\t\tvar toRemove = [];\n\t\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\t\tthis.groupsMenu.remove(toRemove[i]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.fillWithGroups();\n\t\t\t\t\treturn;\n\t\t\t}, this);\n\t\t\t\n\t\t\teyeos.messageBus.getInstance().addListener('eyeos_workgroup_createGroup', function() {\n\t\t\t\t\tvar childrens = this.groupsMenu.getChildren();\n\t\t\t\t\tvar toRemove = [];\n\t\t\t\t\tfor(var i = 0; i < childrens.length; i++) {\n\t\t\t\t\t\tif(i > 0) {\n\t\t\t\t\t\t\ttoRemove.push(childrens[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0;i < toRemove.length; i++) {\n\t\t\t\t\t\tthis.groupsMenu.remove(toRemove[i]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.fillWithGroups();\n\t\t\t\t\treturn;\n\t\t\t}, this);\n\n\t\t\tsearchBoxGroup.addListener('createGroup', function(e) {\n\t\t\t\tvar newWindow = new eyeos.ui.tabs.NewGroupWindow(this.getChecknum());\n\n\t\t\t\tvar bus = eyeos.messageBus.getInstance();\n\t\t\t\tbus.addListener('eyeos_groups_newGroupWindowDone', function() {\n\n\t\t\t\t});\n\t\t\t}, this);\n\n\n\t\t\t\n            this.groupsMenu.add(searchBoxGroup);\n\n\t\t\tthis.fillWithGroups();\n\n            this.groupsMenu.setOpener(groupsBox);\n\n            groupsBox.addListener('click', function(e) {\n                e.stopPropagation();\n                this.groupsMenu.open();\n            }, this);\n\n            \/\/ -------------------------------------\n\n            \/\/separator ----------------------------\n\n            var separator = new qx.ui.basic.Image();\n            separator.setSource('eyeos\/extern\/images\/Separator.png');\n\n            \/\/ -------------------------------------\n\n            containTabs.add(groupsBox);\n            containTabs.add(separator);\n\n            \/\/add containTabs to eyeDesktop.\n            \/\/it is added to eyeDesktop instead of screen because tabs can be on top of windows.\n            \/\/window are places inside eyeDesktop because is the desktop manager.\n            \/\/the height 50% is because tabs fill half of the screen when displayed, not more.\n            screen.addAt(containTabs, 0);\n        },\n\n\t\tfillWithContacts : function(filter) {\n            \/\/now, fill with the contacts\n            eyeos.contacts.ContactManager.getInstance().getAllContacts('accepted', function(e) {\n\t\t\t\tfor(var i=0; i<e.length; i++) {\n\t\t\t\t\t\tvar searchResult = new qx.ui.menu.Userbox();\n\t\t\t\t\t\tsearchResult.setUserData('userId',e[i].getId());\n\t\t\t\t\t\teyeos.contacts.ContactManager.getInstance().getContactsByIds([e[i].getId()], function (data) {\n\t\t\t\t\t\t\tsearchResult.setUserData('userObject', data[0]);\n\t\t\t\t\t\t}, searchResult);\n\t\t\t\t\t\tsearchResult.setUserData('name',e[i].getNickname());\n\t\t\t\t\t\tvar username = e[i].getNickname();\n\t\t\t\t\t\tif(filter && username.indexOf(filter) == -1) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar icon = 'index.php?checknum=' + this.getChecknum() + '&message=__UserInfo_getAvatarPicture&params[userId]='+e[i].getId();\n\t\t\t\t\t\tvar actionIcon = 'eyeos\/extern\/images\/Delete_contact.png';\n\t\t\t\t\t\tsearchResult.fill(username, icon, actionIcon, 140, e[i].getConnected());\n\t\t\t\t\t\tsearchResult.addListener('executeAction', function(e) {\n\t\t\t\t\t\t\tvar userId = this.getUserData('userId');\n\t\t\t\t\t\t\tvar optionPane = new eyeos.dialogs.OptionPane(\n\t\t\t\t\t\t\t\t\"<b>\"+tr(\"Are you sure you want to delete\")+' '+this.getUserData('name')+' '+tr(\"as a contact?\")+\"<\/b>\",\n\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.QUESTION_MESSAGE,\n\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.YES_NO_OPTION);\n\t\t\t\t\t\t\t\tvar dialog = optionPane.createDialog(document.eyeDesktop, tr(\"Delete a contact\"), function(result) {\n\t\t\t\t\t\t\t\t\tif (result == 0) {\n\t\t\t\t\t\t\t\t\t\tvar contactManager = eyeos.contacts.ContactManager.getInstance();\n\t\t\t\t\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t\t\t\t\t\tcontactManager.deleteContact(userId, function () {});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t\tdialog.open();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tsearchResult.addListener('click', function(e) {\n\t\t\t\t\t\t\tvar username = this.getUserData('name');\n\t\t\t\t\t\t\tqx.ui.menu.Manager.getInstance().hideAll();\n\t\t\t\t\t\t\teyeos.execute('files',self.getChecknum(), ['share:\/\/~'+username+'\/']);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.peopleMenu.add(searchResult);\n\t\t\t\t}\n            }, this);\n\t\t},\n\n\t\tfillWithGroups : function(filter, callback, context) {\n\t\t\teyeos.callMessage(this.getChecknum(), '__Workgroups_getAllWorkgroupsByUser', {\n                includeMeta: 'true'\n            }, function (groups) {\n                for (var i = 0; i < groups.length; ++i) {\n\t\t\t\t\t\/\/createMyGroupItem(groups[i]['workgroup'].name, groups[i]['workgroup'].id);\n\t\t\t\t\tvar searchResult = new qx.ui.menu.Userbox();\n\t\t\t\t\tif(filter && groups[i]['workgroup'].name.indexOf(filter) == -1) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t\/\/ If status is pending do not show the workgroup\n\t\t\t\t\tif (groups[i].status != 0) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar icon = 'index.php?checknum=' + this.getChecknum() + '&message=__Workgroups_getWorkgroupPicture&params[workgroupId]=' + groups[i]['workgroup'].id + '&refresh=' + new Date().getTime();\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tsearchResult.setUserData('id', groups[i]['workgroup'].id);\n\t\t\t\t\tif (groups[i].role < 2) {\n\t\t\t\t\t\tvar actionIcon = 'eyeos\/extern\/images\/16x16\/actions\/configure.png';\n\t\t\t\t\t\tsearchResult.addListener('executeAction', function(e) {\n\t\t\t\t\t\t\tqx.ui.menu.Manager.getInstance().hideAll();\n\t\t\t\t\t\t\tnew eyeos.ui.tabs.GroupAdminWindow(self.getChecknum(), this.getUserData('id'));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar actionIcon = 'eyeos\/extern\/images\/Delete_contact.png';\n\t\t\t\t\t\tsearchResult.addListener('executeAction', function(e) {\n\t\t\t\t\t\t\tvar op = new eyeos.dialogs.OptionPane(\n\t\t\t\t\t\t\t\t\ttr('Are you sure you want to leave this workgroup?'),\n\t\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.QUESTION_MESSAGE,\n\t\t\t\t\t\t\t\t\teyeos.dialogs.OptionPane.YES_NO_OPTION);\n\t\t\t\t\t\t\t\top.createDialog(\n\t\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\t\ttr('Join workgroup'),\n\t\t\t\t\t\t\t\t\tfunction (answer) {\n\t\t\t\t\t\t\t\t\t\tif (answer == eyeos.dialogs.OptionPane.YES_OPTION) {\n\t\t\t\t\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\t\t\t\t\tworkgroupId: this.getUserData('id'),\n\t\t\t\t\t\t\t\t\t\t\t\tuserIds: [eyeos.getCurrentUserData().id]\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\teyeos.callMessage(self.getChecknum(), '__Workgroups_deleteMemberships', params, function (result) {\n\t\t\t\t\t\t\t\t\t\t\t\tsearchResult.destroy();\n\t\t\t\t\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tthis, true\n\t\t\t\t\t\t\t).open();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tsearchResult.fill(groups[i]['workgroup'].name, icon, actionIcon, 240);\n\t\t\t\t\tthis.groupsMenu.add(searchResult);\n\n\t\t\t\t\tsearchResult.setUserData('name', groups[i]['workgroup'].name);\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tsearchResult.addListener('click', function(e) {\n\t\t\t\t\t\tvar group = this.getUserData('name');\n\t\t\t\t\t\tqx.ui.menu.Manager.getInstance().hideAll();\n\t\t\t\t\t\teyeos.execute('files',self.getChecknum(), ['workgroup:\/\/~'+group+'\/']);\n\t\t\t\t\t});\n                }\n\t\t\t\tif (callback) {\n\t\t\t\t\tif (context) {\n\t\t\t\t\t\tcallback.call(context);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}\n\t\t\t\t}\n            }, this);\n\t\t}\n    }\n});\n\nqx.Class.define(\"qx.ui.menu.SearchBox\", {\n  extend : qx.ui.menu.Button,\n  construct : function(label, icon, command, menu) {\n    this.base(arguments);\n        var decoratorSearch = new qx.ui.decoration.Background().set({\n                backgroundImage: 'eyeos\/extern\/images\/Search_background.png',\n                backgroundRepeat: 'repeat-x'\n        });\n        this.setDecorator(decoratorSearch);\n        this.set({\n            height: 30\n        });\n        this.addListener('mouseover', function(e) {\n            e.stopPropagation();\n        }, this);\n\n        this.addListener('mouseout', function(e) {\n            e.stopPropagation();\n        }, this);\n\n        this.getChildControl('icon').destroy();\n        this.getChildControl('label').destroy();\n        this.searchField = new qx.ui.form.TextField();\n        var decoratorWidgetMenu = new qx.ui.decoration.RoundBorderBeveled(null, 'white', 0, 10, 10, 10, 10);\n        this.searchField.setDecorator(decoratorWidgetMenu);\n\n        this.searchField.set({\n            width: 180,\n            backgroundColor: 'white',\n            shadow: null\n        });\n\n\t\tthis.timer = new qx.event.Timer(500);\n\t\tthis.searchField.addListener('input', function(e) {\n\t\t\tthis.timer.stop();\n\t\t\tthis.timer.start();\n\t\t}, this);\n\n\t\tthis.timer.addListener('interval', function(e) {\n\t\t\tthis.timer.stop();\n\t\t\tthis.fireDataEvent('doSearch', this.searchField.getValue());\n\t\t}, this);\n\n        this.searchField.setPlaceholder('Search...');\n\n\t\tthis.searchField.addListener('appear', function(e) {\n\t\t\tthis.searchField.focus();\n\t\t}, this);\n        \n        this.add(this.searchField , {column: 0});\n\n\t\tvar buttonAdd = new qx.ui.form.Button(tr('Create group'));\n\t\tbuttonAdd.set({\n\t\t\tmarginLeft:170,\n\t\t\tshadow:null\n\t\t});\n\n\t\tbuttonAdd.addListener('execute', function(e) {\n\t\t\tthis.fireEvent('createGroup');\n\t\t}, this);\n\t\tthis.add(buttonAdd, {column: 1});\n  },\n\n  members: {\n\t\tadd : function(w, o) {\n\t\t  this._add(w, o);\n\t\t},\n\n\t\t_onMouseUp : function() {\n\n\t\t}\n  }\n});\n\nqx.Class.define(\"qx.ui.menu.customMessage\", {\n  extend : qx.ui.menu.Button,\n  construct : function(label, icon, command, menu) {\n    arguments.callee.base.call(this, label, icon, command, menu);\n  },\n\n  members: {\n\t\t_onMouseUp : function() {\n\n\t\t}\n  }\n});\n\nqx.Class.define(\"qx.ui.menu.Userbox\", {\n  extend : qx.ui.menu.Button,\n  construct : function(label, icon, command, menu) {\n    arguments.callee.base.call(this, label, icon, command, menu);\n  },\n\n  members: {\n\t\tadd : function(w, o) {\n\t\t\tthis._add(w, o);\n\t\t},\n\n\t\t_onMouseUp : function() {\n\n\t\t},\n\n\t\tfill : function(text, icon, actionIcon, marginLeft, status) {\n\t\t\t\ttext = escapeHtml(text);\n\t\t\t\tvar user = new qx.ui.basic.Label(text);\n\t\t\t\tuser.set({\n\t\t\t\t\tpadding:6,\n\t\t\t\t\tpaddingLeft: 8,\n\t\t\t\t\trich: true\n\t\t\t\t});\n\t\t\t\tvar image = new qx.ui.basic.Image();\n\t\t\t\timage.set({\n\t\t\t\t\t'scale' : true,\n\t\t\t\t\t'height' : 22,\n\t\t\t\t\t'width' : 22\n\t\t\t\t});\n\t\t\t\timage.setSource(icon);\n\n\t\t\t\tthis.actionImage = new qx.ui.basic.Image();\n\t\t\t\tthis.actionImage.setSource(actionIcon);\n\n\t\t\t\tvar composite = new qx.ui.container.Composite();\n\t\t\t\tcomposite.setLayout(new qx.ui.layout.Canvas());\n\t\t\t\tthis.add(image,{column:0});\n\t\t\t\tthis.add(composite,{column:1});\n\t\t\t\tcomposite.add(user, {left: 0});\n\t\t\t\tthis.statusImage = new qx.ui.basic.Image();\n\t\t\t\tif(!status) {\n\t\t\t\t\tthis.statusImage.exclude();\n\t\t\t\t} else {\n\t\t\t\t\tuser.setValue('<span style=\"color:green;font-weight:bold\">'+text+'<\/span>')\n\t\t\t\t}\n\t\t\t\tthis.statusImage.setSource('eyeos\/extern\/images\/16x16\/actions\/view-process-users.png');\n\t\t\t\tcomposite.add(this.statusImage, {left:marginLeft-22, top:5});\n\t\t\t\tcomposite.add(this.actionImage, {left: marginLeft, top:5});\n\n\t\t\t\tthis.statusImage.addListener('click', function(e) {\n\t\t\t\t\tvar dbus = eyeos.messageBus.getInstance();\n\t\t\t\t\tdbus.send('chat', 'requestchat', this.getUserData('userObject'));\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}, this);\n\n\t\t\t\tthis.addListener('mouseover', function(e) {\n\t\t\t\t\tthis.getLayoutParent().setSelectedButton(this);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}, this);\n\n\t\t\t\tthis.actionImage.addListener('click', function(e) {\n\t\t\t\t\tthis.fireEvent('executeAction');\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}, this);\n\t\t},\n\n\t\tsetActionIcon : function(icon) {\n\t\t\tthis.actionImage.setSource(icon);\n\t\t}\n  }\n});\ntopmenu_application(123709005, 2735, [0,[{\"name\":\"session\",\"displayName\":\"Session\",\"app\":\"session\",\"shortDescription\":\"\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Core\",\"listable\":0},{\"name\":\"contactmanager\",\"displayName\":\"Contact Manager\",\"app\":\"contactmanager\",\"shortDescription\":\"eyeOS Contact Manager\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"System\",\"listable\":0},{\"name\":\"chat\",\"displayName\":\"Chat\",\"app\":\"chat\",\"shortDescription\":\"Talk with your contacts\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/konversation.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":1},{\"name\":\"pdfviewer\",\"displayName\":\"pdfviewer\",\"app\":\"pdfviewer\",\"shortDescription\":\"View pdf documents\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"viewer\",\"displayName\":\"Viewer\",\"app\":\"viewer\",\"shortDescription\":\"View documents and play media files\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"newusersettings\",\"displayName\":\"New User Settings\",\"app\":\"newusersettings\",\"shortDescription\":\"User Settings\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Utils\",\"listable\":0},{\"name\":\"imageviewer\",\"displayName\":\"imageviewer\",\"app\":\"imageviewer\",\"shortDescription\":\"View image documents\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"iframize\",\"displayName\":\"Iframize\",\"app\":\"iframize\",\"shortDescription\":\"Iframize resources\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-user.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"calendar\",\"displayName\":\"Calendar\",\"app\":\"calendar\",\"shortDescription\":\"Organize your planning and share events with people\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/actions\\\/view-pim-calendar.png\",\"favorite\":1,\"lists\":\"Office\",\"listable\":1},{\"name\":\"addressbook\",\"displayName\":\"Addressbook\",\"app\":\"addressbook\",\"shortDescription\":\"addressbook to manage contacts\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/office-address-book.png\",\"favorite\":0,\"lists\":\"Mail\",\"listable\":0},{\"name\":\"toptabs\",\"displayName\":\"toptabs\",\"app\":\"toptabs\",\"shortDescription\":\"toptabs\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"urlshare\",\"displayName\":\"URLShare\",\"app\":\"urlshare\",\"shortDescription\":\"Share files by URL\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-user.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"runas\",\"displayName\":\"Run As\",\"app\":\"runas\",\"shortDescription\":\"Run an application as a different user\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/status\\\/dialog-password.png\",\"favorite\":0,\"lists\":\"Utils\",\"listable\":0},{\"name\":\"login\",\"displayName\":\"Login\",\"app\":\"login\",\"shortDescription\":\"\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Core\",\"listable\":0},{\"name\":\"download\",\"displayName\":\"Download\",\"app\":\"download\",\"shortDescription\":\"Download files to local system\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"System\",\"listable\":0},{\"name\":\"logout\",\"displayName\":\"Logout\",\"app\":\"logout\",\"shortDescription\":\"\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Code\",\"listable\":0},{\"name\":\"upload\",\"displayName\":\"Upload\",\"app\":\"upload\",\"shortDescription\":\"Upload files\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-user.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"files\",\"displayName\":\"File Manager\",\"app\":\"files\",\"shortDescription\":\"Access and manage your files\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/system-file-manager.png\",\"favorite\":1,\"lists\":\"Desktop\",\"listable\":1},{\"name\":\"howto\",\"displayName\":\"How to use eyeOS\",\"app\":\"howto\",\"shortDescription\":\"Help with the first steps with eyeOS\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/categories\\\/system-help.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":1},{\"name\":\"topmenu\",\"displayName\":\"topmenu\",\"app\":\"topmenu\",\"shortDescription\":\"topmenu\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"welcomepage\",\"displayName\":\"Welcome Page\",\"app\":\"welcomepage\",\"shortDescription\":\"Page with a introduction of eyeOS\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/welcome-manual.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":1},{\"name\":\"netsync\",\"displayName\":\"NetSync\",\"app\":\"netsync\",\"shortDescription\":\"\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Core\",\"listable\":0},{\"name\":\"notepad\",\"displayName\":\"Notepad\",\"app\":\"notepad\",\"shortDescription\":\"A very simple text editor\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/scribus.png\",\"favorite\":1,\"lists\":\"Utils\",\"listable\":1},{\"name\":\"calculator\",\"displayName\":\"Calculator\",\"app\":\"calculator\",\"shortDescription\":\"A calculator\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/accessories-calculator.png\",\"favorite\":1,\"lists\":\"Utils\",\"listable\":1},{\"name\":\"openwith\",\"displayName\":\"OpenWith\",\"app\":\"openwith\",\"shortDescription\":\"Open With utility\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Core\",\"listable\":0},{\"name\":\"rmail\",\"displayName\":\"Mail Client\",\"app\":\"rmail\",\"shortDescription\":\"Read and write e-mails\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/internet-mail.png\",\"favorite\":0,\"lists\":\"Code\",\"listable\":1},{\"name\":\"taskbar\",\"displayName\":\"taskbar\",\"app\":\"taskbar\",\"shortDescription\":\"taskbar\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"sysmon\",\"displayName\":\"SysMon\",\"app\":\"sysmon\",\"shortDescription\":\"System monitor\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/utilities-system-monitor.png\",\"favorite\":0,\"lists\":\"Utils\",\"listable\":1},{\"name\":\"desktop\",\"displayName\":\"Desktop\",\"app\":\"desktop\",\"shortDescription\":\"\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Core\",\"listable\":0},{\"name\":\"newlink\",\"displayName\":\"newLink\",\"app\":\"newlink\",\"shortDescription\":\"newLink\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-user.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"documents\",\"displayName\":\"Documents\",\"app\":\"documents\",\"shortDescription\":\"Create office documents\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/okteta.png\",\"favorite\":1,\"lists\":\"Office\",\"listable\":1},{\"name\":\"docviewer\",\"displayName\":\"docviewer\",\"app\":\"docviewer\",\"shortDescription\":\"View pdf documents\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"about\",\"displayName\":\"about\",\"app\":\"about\",\"shortDescription\":\"About eyeOS\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Dev\",\"listable\":0},{\"name\":\"openlink\",\"displayName\":\"openlink\",\"app\":\"openlink\",\"shortDescription\":\"open resources link into iframize\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-user.png\",\"favorite\":0,\"lists\":\"Desktop\",\"listable\":0},{\"name\":\"init\",\"displayName\":\"Init\",\"app\":\"init\",\"shortDescription\":\"\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Core\",\"listable\":0},{\"name\":\"events\",\"displayName\":\"Events\",\"app\":\"events\",\"shortDescription\":\"\",\"image\":\"index.php?extern=\\\/images\\\/22x22\\\/apps\\\/preferences-desktop-default-applications.png\",\"favorite\":0,\"lists\":\"Code\",\"listable\":0}]]);"},"__eyeos_specialControlMessage_options":null});