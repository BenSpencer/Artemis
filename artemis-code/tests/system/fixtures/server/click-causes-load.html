<!DOCTYPE html><html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Ben Spencer</title>
    <meta name="author" content="Ben Spencer">

    <script type="text/javascript" >
        function sleep(msec) {
            var time = new Date().getTime()
            var end = time + msec;
            while(true) {
                time = new Date().getTime()
                if (time > end) {
                    break;
                }
            }
        }
        
        window.onload = function () {
            
            var x = document.getElementById("click-xhr");
            x.addEventListener("click", function (e) {
                
                e.preventDefault()
                
                var status = document.getElementById("status");
                status.textContent = "Loading...";
                
                var xhr = new XMLHttpRequest();
                //xhr.withCredentials = true;
                xhr.open("GET", "https://cors-test.appspot.com/test", true);
                
                xhr.onload = function () {
                    status.textContent = "Finished loading. Sleeping 3s.";
                    sleep(3000);
                    status.textContent = "Done.";
                }
                
                xhr.send();
                
            }, false);
            
        }
    </script>
</head>
<body>

    <ul>
        <li><a href="slow-load.html" id="click-pageload" >Click causes page-load.</a></li>
        <li><a href="#" id="click-xhr" >Click causes XHR load.</a></li>
    </ul>

    <hr>

    <p>Status: <span id="status">Nothing happening.</span></p>

</body>
</html>
